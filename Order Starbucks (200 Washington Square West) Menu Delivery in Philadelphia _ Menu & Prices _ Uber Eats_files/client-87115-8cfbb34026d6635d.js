"use strict";(self.webpackChunkFusion=self.webpackChunkFusion||[]).push([[87115],{13399:(e,n,t)=>{t.d(n,{N:()=>R});var i=t(90417),o=t(40304),r=t(66146),s=t(1139),a=t(84183),c=t(41908),u=t(70665),l=t(16924),d=t(97224),p=t(93617),g=t(53728),m=t(91156),h=t(69909),f=t(13123);const y=/FBAN|FBAV|FBSV|FBSS|FBCR|FBOP|FBDV|FBDM|FBID|FBV/,k=/FBMF/,A=/Instagram[\s/][\d.]+/,_=/ByteDanceWebview|musical_ly|trill|aweme|TikTok/,b=/TwitterAndroid|Twitter for iPhone|TWITTERIPHONE/,v=/Snapchat/,w=/LinkedInApp/,B=/Pinterest/,S=/WhatsApp|WHATSAPP/,I=/Telegram/,T=/Discord/,P=/RedditApp/,F=/MicroMessenger/,M=/Line/,D=/(GSA\/|GoogleApp)/i,V=/(com\.google\.android\.apps\.maps|com\.google\.Maps)/i,C={Facebook:"Facebook",Messenger:"Messenger",Instagram:"Instagram",TikTok:"TikTok",Twitter:"Twitter",Snapchat:"Snapchat",LinkedIn:"LinkedIn",Pinterest:"Pinterest",WhatsApp:"WhatsApp",Telegram:"Telegram",Discord:"Discord",Reddit:"Reddit",WeChat:"WeChat",Line:"Line",GSA:"GSA","Google Search App":"Google Search App","Chrome WebView":"Chrome WebView",KakaoTalk:"KakaoTalk",KakaoStory:"KakaoStory",QQ:"QQ",Weibo:"Weibo",baiduboxapp:"baiduboxapp"},x=e=>{const{browser:n,os:t,device:i}=e;if(!n.name)return null;if(!("mobile"===i.type||"iOS"===t.name||"Android"===t.name))return null;const o=(e=>C[e]??null)(n.name);return o?{type:o,confidence:"high",indicators:["parsed name allowlist match",`parsed name ${n.name.toLowerCase()}`]}:null},W=e=>{const{userAgent:n}=e;if(y.test(n)){const e=n.match(/\b(FBAN|FBAV|FBSV|FBSS|FBCR|FBOP|FBDV|FBDM|FBID|FBV)\b/g)||[];if(e.length>=2)return{type:"Facebook",confidence:"high",indicators:["multiple facebook indicators",...e]};if(1===e.length)return{type:"Facebook",confidence:"medium",indicators:["single facebook indicator",...e]}}if(k.test(n))return{type:"Messenger",confidence:"high",indicators:["facebook messenger"]};if(A.test(n)){const e=n.match(/Instagram[\s/]([\d.]+)/);return e?{type:"Instagram",confidence:"high",indicators:["instagram_with_version",e[0]]}:{type:"Instagram",confidence:"medium",indicators:["instagram detected"]}}return null},L=e=>{const{userAgent:n}=e,t=[{regex:_,type:"TikTok",name:"tiktok"},{regex:b,type:"Twitter",name:"twitter"},{regex:v,type:"Snapchat",name:"snapchat"},{regex:w,type:"LinkedIn",name:"linkedin"},{regex:B,type:"Pinterest",name:"pinterest"},{regex:S,type:"WhatsApp",name:"whatsapp"},{regex:I,type:"Telegram",name:"telegram"},{regex:T,type:"Discord",name:"discord"},{regex:P,type:"Reddit",name:"reddit"},{regex:F,type:"WeChat",name:"wechat"},{regex:M,type:"Line",name:"line"}];for(const e of t)if(e.regex.test(n)){const t=n.match(e.regex);return{type:e.type,confidence:"high",indicators:[`${e.name} app`,...t?[t[0]]:[]]}}return null},G=e=>{const{userAgent:n}=e;return V.test(n)?{type:"GSA",confidence:"high",indicators:["google maps app"]}:D.test(n)?{type:"GSA",confidence:"high",indicators:["google search app"]}:null};var E=t(11752),O=t(79193);function U(){const e=(0,h.A)("user_agent_data"),n=(0,E.A)(),t=(0,i.useMemo)((()=>((e,n,t)=>{const i=e?.ua;if(!i||"string"!=typeof i)return{isInAppBrowser:!1,inAppBrowserType:null,confidence:"high",indicators:["invalid user agent"]};if(/bot|crawler|spider/i.test(i))return{isInAppBrowser:!1,inAppBrowserType:null,confidence:"high",indicators:["likely bot"]};if(n&&Boolean(n.get(f.UG)))return{isInAppBrowser:!1,inAppBrowserType:null,confidence:"high",indicators:[]};const o={name:e.browser.name||"Unknown",version:e.browser.version||""},r={name:e.os.name||"Unknown"},s={type:e.device.type||(/Mobile|Android|iPhone|iPad/i.test(i)?"mobile":void 0)},a=[];let c=null,u="low";const l={userAgent:i,browser:o,os:r,device:s},d=[x,W,L,G];for(const e of d){const n=e(l);if(n){c=n.type,u=n.confidence,a.push(...n.indicators);break}}if(!c){const e=[e=>((e,n)=>{const{os:t,device:i,browser:o}=e;return"iOS"===t.name&&"mobile"===i.type&&o.name.toLowerCase().includes("safari")&&n&&n.navigator&&"undefined"==typeof n.navigator?.standalone?{type:"Safari Webview",confidence:"high",indicators:["navigator.standalone=undefined","iOS device","likely WebView"]}:null})(e,t),e=>((e,n)=>{const{device:t,os:i}=e;if("mobile"!==t.type&&"iOS"!==i.name&&"Android"!==i.name)return null;if(!n||!n.navigator)return null;const o=[];return"share"in n.navigator&&"function"==typeof n.navigator.share||o.push("navigator.share"),"PaymentRequest"in n||o.push("PaymentRequest"),"serviceWorker"in n.navigator||o.push("ServiceWorker"),"Notification"in n||o.push("Notification"),o.length>=3?{type:"Unknown",confidence:"low",indicators:["missing APIs",...o,"mobile device"]}:null})(e,t)];let n="low",i=null;const o=[];for(const t of e){const e=t(l);e&&((!i||"high"===e.confidence||"medium"===e.confidence&&"low"===n)&&(i=e.type,n=e.confidence),o.push(...e.indicators))}i&&(c=i,u=n,a.push(...o))}if(c){const e="Windows"===r.name||"Mac OS"===r.name||"Linux"===r.name,n=/Windows NT|Macintosh|Linux.*X11/i.test(i),t="mobile"===s.type||/Mobile|Android|iPhone|iPad/i.test(i);!e&&!n||t||(u="low",a.push("desktop environment detected"))}const p=null!==c;return{isInAppBrowser:p,inAppBrowserType:c,confidence:p?u:"high",indicators:a}})(e,n,O.A)),[e,n]);return t}const R=function(){const e=function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const n=(0,u.lU)(),{user:t,isUnregisteredUser:h}=(0,a.A)(),f=t.data?.isLoggedIn,y=!f&&h,k=(0,l.A)(),A=(0,g.A)(),{draftOrder:_}=(0,c.tC)(),b=(0,p.we)(_),{isOnPremiseDeliveryOrder:v}=(0,d.A)(),w=(0,m.Ay)(),B=(0,i.useRef)(!1),S=(0,o.vm)({...s.z.guest_checkout_m2_disable_inapp,defaultValue:r.G.guest_checkout_m2_disable_inapp.defaultValue}),I=U(),T=n&&y&&!k&&!A&&b&&!v&&!(S&&I?.isInAppBrowser&&"high"===I?.confidence);return(0,i.useEffect)((()=>{!B.current&&e&&I?.isInAppBrowser&&n&&y&&(w("eats:guest_checkout_m2_in_app_browser_eligible",{browserType:I?.inAppBrowserType||"unknown",confidence:I?.confidence,indicators:I?.indicators}),B.current=!0)}),[e,w,I,n,y]),T}(arguments.length>0&&void 0!==arguments[0]&&arguments[0]),n=(0,o.KU)();return(0,i.useMemo)((()=>!!e&&n.getBoolean({...s.z.guest_checkout_m2,defaultValue:r.G.guest_checkout_m2.defaultValue})),[n,e])}},38275:(e,n,t)=>{t.d(n,{A:()=>r});var i=t(31725),o=t(16924);const r=()=>{const e=(0,i.A)("guest_checkout_webshop_enabled");return(0,o.A)()&&e}},61521:(e,n,t)=>{t.d(n,{A:()=>g});var i=t(90417),o=t(40304),r=t(91156),s=t(84183),a=t(1139),c=t(66146),u=t(41908),l=t(8700),d=t(73029),p=t(38275);function g(){const{user:e,isUnregisteredUser:n}=(0,s.A)(),t=e.data?.isLoggedIn,g=(0,o.vm)({...a.z.guest_checkout,defaultValue:c.G.guest_checkout.defaultValue}),m=(0,o.Ab)({...a.z.guest_checkout_guest_mode,defaultValue:c.G.guest_checkout_guest_mode.defaultValue}),h=(0,p.A)(),f=function(){const{serverCart:e}=(0,u.B_)(),n=e.data?.storeUuid,{store:t}=(0,l.Ay)(n);return Boolean(t.data?.isVenueStore)}(),y=(0,i.useMemo)((()=>{const e=!t&&n;return!(!f||!e)||e&&(g||h)}),[g,t,n,f,h]),k=function(e,n,t){const o=(0,r.Ay)(),s=(0,d.A)(),a=s?"eats:guest_checkout_in_guest_mode_enabled_citrus_xp":"eats:guest_checkout_enabled_citrus_xp",c=s?"eats:guest_checkout_in_guest_mode_enabled_citrus_xp_all_events":"eats:guest_checkout_enabled_citrus_xp_all_events";return(0,i.useCallback)((i=>{!e&&n&&o(a,{param_name:"guest.checkout.enabled",param_value:String(t),isGuestCheckoutEligible:Boolean(i)}),o(c,{param_name:"guest.checkout.enabled",param_value:String(t),isGuestCheckoutEligible:Boolean(i),isLoggedIn:Boolean(e),isUnregisteredUser:Boolean(n),isGuestModeApp:Boolean(s)})}),[o,e,n,s,a,c,t])}(Boolean(t),n,g);return{guestCheckoutEnabled:y,emitGuestCheckoutEvent:k,guestCheckoutInGuestModeXP:m,isGuestSession:!t&&n}}},70665:(e,n,t)=>{t.d(n,{lU:()=>r});var i=t(79193);const o=3;function r(){if(!i.A)return!1;try{if(i.A.ApplePaySession)return i.A.ApplePaySession.canMakePayments()&&i.A.ApplePaySession.supportsVersion(o)}catch(e){return!1}}},97224:(e,n,t)=>{t.d(n,{A:()=>y,f:()=>f});var i=t(90417),o=t(50371),r=t(74225),s=t(9473),a=t(8474),c=t(89831),u=t(63204),l=t(86105),d=t(17649),p=t(32879);const g="uev2.premise-delivery-info",m="premise_delivery_info",h=86400;function f(e){if(!e)return null;const n=e.premiseDeliveryInfo;if(!n)return null;return[n.map((e=>{let{label:n,venueSectionName:t}=e;return`${n} ${t}`})).join(", "),e.notes].filter(Boolean).join(" - ")}function y(){const e=(0,u.Mj)(),n=(0,l.zy)(),t=(0,o.W6)(),y=(0,c.wA)(),k=(0,p.Yh)(),{diningMode:A}=(0,d.A)(),_=(0,r.useQueryClient)(),b="ON_PREMISE_DELIVERY"===A?"HOTEL":"STADIUM",v=k?.data?.checkoutPayloads?.venueSectionPicker?.venueSectionPickerViewModel||null,w=(0,r.useQuery)(m,(()=>_.getQueryData(m)||{}),{staleTime:1/0})?.data??null,B=(0,i.useCallback)((n=>{e.set(g,n,h),_.setQueryData(m,n)}),[e,_]),S=(0,i.useCallback)((()=>{e.remove(g),_.removeQueries({queryKey:m,exact:!0})}),[e,_]),I=(0,i.useCallback)((e=>{B(e),y((0,s.OC)({tableNumber:f(e)||"",action:"complete"})),t.push((0,a.my9)(n))}),[B,y,t,n]),T="ON_PREMISE_DELIVERY"===A||Boolean(v);return(0,i.useEffect)((()=>{const n=e.get(g);Boolean(n)&&!w&&_.setQueryData(m,n)}),[e,w,_]),{setPremiseDeliveryInfo:B,removePremiseDeliveryInfo:S,checkoutWithPremiseDeliveryInfo:I,venueSectionPickerViewModel:v,isOnPremiseDeliveryOrder:T,premiseDeliveryInfo:w,premiseDeliveryType:b,isLoading:!k?.hasLoaded}}}}]);
//# sourceMappingURL=https://sourcemaps.uberinternal.com/raw/web-eats-v2/client-87115-8cfbb34026d6635d.js.map