"use strict";(self.webpackChunkFusion=self.webpackChunkFusion||[]).push([[49386],{17803:(e,t,a)=>{a.d(t,{N:()=>l,v:()=>d});var r=a(40304),n=a(68252),o=a(91156),i=a(90417),s=a(67508);const d=()=>{let e;const t=(0,o.eh)(),a=(0,r.Ab)({...n.G.menu_item_rating,defaultValue:"default"});return"treatment_1"!==a&&"treatment_2"!==a||(e="EATER_ENDORSED"),(0,i.useEffect)((()=>{t("eats:eats_web_cro_store_dish_rating_inclusion",{param_name:"menu_item_rating",param_value:a})}),[t,a]),{itemRatingTreatmentName:a,cbType:e}},l=e=>{const{itemRatingTreatmentName:t}=d(),a=(0,o.Ay)(),{totalMenuItems:r,totalMenuItemsWithRatings:n,totalMenuItemsWithRatingsInTreatment:l}=(0,i.useMemo)((()=>(0,s.U7)(e,t)),[e,t]);(0,i.useEffect)((()=>{"treatment_1"!==t&&"treatment_2"!==t||a("eats:total_menu_item_ratings",{menuItemRatings:{totalMenuItems:String(r),totalMenuItemsWithRatings:String(n),totalMenuItemsWithRatingsInTreatmentGroup:String(l),treatmentName:t}})}),[a,r,n,l,t])}},20775:(e,t,a)=>{a.d(t,{A:()=>d});var r=a(57891),n=a(94263),o=a(70994),i=a(71085),s=a(8700);const d=e=>{let{preparedId:t,cbType:a,diningMode:d,fetchSeoContentEnabled:l,primaryBundledStoreUuid:u,orderUuid:c}=e;const _=(0,n.A)("uev2.fee-education-nugget"),p=Boolean(l),y=(0,r.XU)((e=>e.encodedStoreUuid)),m=(0,i.A)({encodedStoreUuid:y}),{store:f}=(0,s.Ay)(m,{preparedId:t,sfNuggetCount:_,...a?{cbType:a}:null,...d?{diningMode:d}:null,...u?{primaryStoreUUID:u}:null,fetchSeoContentEnabled:p,...c?{orderUuid:c}:{}});return{store:f,partialStore:(0,o.hb)(m),fetchSeoContentEnabled:l}}},38722:(e,t,a)=>{a.d(t,{P:()=>r});let r=function(e){return e.horizontalGridPayload="horizontalGridPayload",e.verticalGridPayload="verticalGridPayload",e.exploreMenuPayload="exploreMenuPayload",e.standardItemsPayload="standardItemsPayload",e.eaterMessagingPayload="eaterMessagingPayload",e.categoryItemPayload="categoryItemPayload",e.specialRequestPayload="specialRequestPayload",e.emptyStatePayload="emptyStatePayload",e.adCanvasPayload="adCanvasPayload",e.bundleStorePayload="bundleStorePayload",e.aisleShortcutItems="aisleShortcutItems",e.activeCartPayload="activeCartPayload",e.comboItemsPayload="comboItemsPayload",e.unknown="unknown",e}({})},49386:(e,t,a)=>{a.d(t,{Ay:()=>x,oX:()=>A,jU:()=>h});var r=a(90417),n=a("__fusion__95b4ba69e5"),o=a(8700),i=a(20775),s=a(35152),d=a(57891),l=a(8474),u=a(17803),c=a(84302),_=a(62461),p=a(71085),y=a(39332),m=a(91156),f=a(67508);Object.freeze({"internal.server.error":"internal.server.error"}),Object.freeze({"invalid.request.error":"invalid.request.error"}),Object.freeze({"entity.not.found":"entity.not.found"}),Object.freeze({"eats.get_store_not_found":"eats.get_store_not_found"});const S=Object.freeze({"eats.get_store_inactive_account":"eats.get_store_inactive_account"});Object.freeze({"rtapi.eats.promotion_error.duplicate":"rtapi.eats.promotion_error.duplicate"}),Object.freeze({"eats.city_areas.errors.latlong_missing":"eats.city_areas.errors.latlong_missing"}),Object.freeze({"eats.get_store_invalid_account":"eats.get_store_invalid_account"}),Object.freeze({"eats.order.error.invalid_state_change":"eats.order.error.invalid_state_change"}),Object.freeze({"eats.payment_in_arrears":"eats.payment_in_arrears"}),Object.freeze({"eats.submit_ratings_user_error":"eats.submit_ratings_user_error"}),Object.freeze({"eats.tip_already_processed":"eats.tip_already_processed"}),Object.freeze({"eats.tip_exceeded_max":"eats.tip_exceeded_max"}),Object.freeze({"eats.additional_tip_exceeded_max":"eats.additional_tip_exceeded_max"}),Object.freeze({"eats.too_many_tips_submitted":"eats.too_many_tips_submitted"}),Object.freeze({"eats.fulfillment_issues_not_resolved":"eats.fulfillment_issues_not_resolved"}),Object.freeze({"eats.orders.missing_order_status_data":"eats.orders.missing_order_status_data"}),Object.freeze({"eats.chain_store_not_found":"eats.chain_store_not_found"}),Object.freeze({"eats.order.unauthorized":"eats.order.unauthorized"}),Object.freeze({"eats.cart_already_ordered":"eats.cart_already_ordered"}),Object.freeze({"eats.invalid.delivery_time":"eats.invalid.delivery_time"}),Object.freeze({"eats.orders.update_order_preparation_time.cannot_update":"eats.orders.update_order_preparation_time.cannot_update"}),Object.freeze({"eats.store.supply_device.not_found":"eats.store.supply_device.not_found"}),Object.freeze({"rtapi.eats.invalid_phone_number":"rtapi.eats.invalid_phone_number"}),Object.freeze({"rtapi.eats.billboard.showcase.error":"rtapi.eats.billboard.showcase.error"}),Object.freeze({"eats.product.notFound":"eats.product.notFound"}),Object.freeze({"eats.order.not_found":"eats.order.not_found"}),Object.freeze({"eats.pincode.not_found":"eats.pincode.not_found"}),Object.freeze({"eats.no_menu_only_alcoholic_items_available":"eats.no_menu_only_alcoholic_items_available"}),Object.freeze({"rtapi.users.promotion_error":"rtapi.users.promotion_error"}),Object.freeze({"eats.cannot_use_own_funds":"eats.cannot_use_own_funds"}),Object.freeze({"eats.cannot_use_plus_card":"eats.cannot_use_plus_card"}),Object.freeze({"eats.age_validation_error":"eats.age_validation_error"}),Object.freeze({"eats.survey.notFound":"eats.survey.notFound"});var g=a(96310),E=a(40014);const b={hasLoaded:!1,isLoading:!1,data:null,error:null},I=(0,r.createContext)({storeUuid:"",store:b,partialStore:null,primaryStore:b,isGrStore:null,queueCatalogItemImpression:()=>{}}),P="b71a1b81-66e9-4d59-a010-4cf69751d178",T=e=>{let{children:t,preparedId:a}=e;const r=(0,m.Ay)(),b=n.useRef({}),T=n.useRef({}),h=n.useRef(!1),A=n.useCallback((()=>{const e=Object.values(T.current),t=[],a=[];if(e.forEach((e=>{const r="ORDER_AGAIN"===e.catalogSectionAnalyticsData?.storeSectionType,n=e.originalCatalogSectionUuid===P;r||n?t.push(e):a.push(e)})),a.length>0&&r("eats:store_catalog_item_impression",{storeCatalog:{items:a}}),t.forEach((e=>{const t=e.originalCatalogSectionUuid===P;r("eats:order_again_item_impression",{itemUuid:e.itemUuid,itemPosition:e.itemPosition,isAvailable:e.isAvailable,feedType:t?"order_again":"shop",hasCheaperAlternative:e.hasCheaperAlternative})})),!h.current){e.some((e=>e.hasCheaperAlternative))&&(r("eats:cheaper_alternatives_tag_impression"),h.current=!0)}T.current={}}),[r]),x=(0,y.A)(A,500),O=n.useCallback((e=>{const t=(0,f.w7)(e);b.current[t]||(T.current[t]=e,b.current[t]=!0,x())}),[x]),v=(0,d.XU)((e=>e.encodedStoreUuid)),U=(0,p.A)({encodedStoreUuid:v}),{diningMode:R,primaryBundledStoreUuid:C,liveOrderUuid:j,navigationLink:L}=(0,s._l)((e=>({...(0,l.g$k)(e,["diningMode","primaryBundledStoreUuid","liveOrderUuid"]),navigationLink:e?.state?.navigationLink}))),{cbType:z}=(0,u.v)(),M=(0,c.jf)(R),{isStorePrecheckoutBundlingEnabled:N}=(0,_.A)(),D=(0,g.A)(),{store:H,partialStore:G}=(0,i.A)({preparedId:a,cbType:z,diningMode:M,fetchSeoContentEnabled:!0,primaryBundledStoreUuid:C,orderUuid:j}),{store:B}=(0,o.Ay)(N?C:null,{orderUuid:j}),w="USE_SECTION_AS_CATEGORY"===H.data?.menuDisplayType||!H.data&&null;n.useEffect((()=>{H.error&&H.error.message==S["eats.get_store_inactive_account"]&&L&&r("eats:store_onboarding_inactive_from_navigation_links",{prevPage:L})}),[H.error,r,L]);const k=n.useMemo((()=>({storeUuid:U,store:H,primaryStore:B,partialStore:G,isGrStore:w,queueCatalogItemImpression:O})),[U,H,B,G,w,O]),V=D?k:{storeUuid:U,store:H,primaryStore:B,partialStore:G,isGrStore:w,queueCatalogItemImpression:O};return(0,E.Y)(I.Provider,{value:V,children:t})},h=(e,t)=>{const a=a=>(0,E.Y)(T,{preparedId:e,children:(0,E.Y)(t,{...a})}),r=t.displayName||t.name||"";return a.displayName="WithStoreProvider("+r+")",a},A=()=>{const e=(0,r.useContext)(I);if(null!==e)return e;throw Error("You should call useStoreContext() only in a descendant of <StoreProvider>")},x=T},50842:(e,t,a)=>{a.d(t,{U:()=>r});const r={standardHeaderPayload:"standardHeaderPayload",storeHeaderPayload:"storeHeaderPayload",bannerHeaderPayload:"bannerHeaderPayload",sponsoredDisplayBannerHeaderPayload:"sponsoredDisplayBannerHeaderPayload"}},67508:(e,t,a)=>{a.d(t,{$l:()=>x,AF:()=>s,B:()=>p,CV:()=>b,Dp:()=>v,Fd:()=>P,J_:()=>I,Kx:()=>l,LU:()=>y,Mf:()=>g,NR:()=>T,Qc:()=>_,U7:()=>A,Xu:()=>E,op:()=>h,rp:()=>c,w7:()=>d,xM:()=>O,zq:()=>S});var r=a(38722),n=a(50842),o=a(96951);const i=3;function s(e){return Object.entries(e||{}).reduce(((e,t)=>{let[a,r]=t;const n=r.reduce(((e,t)=>{const a=l(t);return e+(a?.catalogItems?.length||0)}),0);return e+n}),0)}function d(e){return`${e.sourceType}-${e.storeUuid}-${e.sectionUuid}-${e.subsectionUuid}-${e.itemUuid}`}function l(e){return e.payload?.type===r.P.standardItemsPayload?e.payload.standardItemsPayload:null}function u(e){return e.payload?.type===r.P.categoryItemPayload?e.payload.categoryItemPayload:null}function c(e){if(!e)return null;const t=l(e);return t?.catalogSectionHeaderPayload?.type===n.U.sponsoredDisplayBannerHeaderPayload?t?.catalogSectionHeaderPayload.sponsoredDisplayBannerHeaderPayload:null}function _(e){return Object.values(e||{}).flat().find((e=>e.type===o.xL.BUNDLE_STORE))}function p(e){if(!e)return null;const t=l(e);if(t)return f(t);const a=function(e){return e.payload?.type===r.P.bundleStorePayload?e.payload.bundleStorePayload:null}(e);if(a){const e=a.title?.richTextElements?.[0];if("text"===e?.type)return e.text?.text?.text}const n=u(e);if(n){const e=n?.title;return e||""}const o=function(e){return e.payload?.type===r.P.adCanvasPayload?e.payload?.adCanvasPayload:null}(e);if(o){return m(o)||""}return null}function y(e){if(!e)return null;const t=l(e);return t?.catalogSectionAnalyticsData}const m=e=>{if(!e)return"";const t=e?.adsExperimentalStorePayload?.parent?.title;return O(t)&&function(e){return"text"===e?.type}(t?.label?.richText?.richTextElements?.[0])?t?.label?.richText?.richTextElements?.[0]?.text?.text?.text:""},f=e=>{if(!e)return"";{const t=e.catalogSectionHeaderPayload;if(e.titleV2){return(e.titleV2?.richTextElements||[]).filter((e=>"text"===e.type)).map((e=>"text"in e?e.text?.text?.text:"")).join(" ").trim()||""}if(e.title)return e.title?.text;if(t)switch(t?.type){case n.U.standardHeaderPayload:return"text"===t?.standardHeaderPayload?.title?.richTextElements?.[0]?.type?t?.standardHeaderPayload?.title?.richTextElements?.[0]?.text?.text?.text:"";case n.U.storeHeaderPayload:return"text"===t?.storeHeaderPayload?.title?.richTextElements?.[0]?.type?t?.storeHeaderPayload?.title?.richTextElements?.[0]?.text?.text?.text:"";case n.U.bannerHeaderPayload:return"text"===t?.bannerHeaderPayload?.title?.richTextElements?.[0]?.type?t?.bannerHeaderPayload?.title?.richTextElements?.[0]?.text?.text?.text:"";default:return""}}return""};function S(e){switch(e.payload?.type){case r.P.standardItemsPayload:return l(e)?.ctaMetadata?.ctaUri||"";case r.P.categoryItemPayload:return u(e)?.ctaUri||""}return""}function g(e){if(!e)return null;const t=l(e);return t?t?.ctaMetadata:null}function E(e){const t=(e||[]).filter((e=>e.imageUrl)).slice(0,i);return{visibleItems:t,itemsWithoutImagesCount:(e||[]).length-t.length}}function b(e,t,a){if(!e||!a)return[];let r=e;return t&&a&&a[t]&&(r=a[t]),r??[]}function I(e,t){let a=0;return e.reduce(((e,n)=>{const o=n.catalogSectionUUID;if(!o||n.payload?.type!==r.P.standardItemsPayload)return e;const i=n.payload?.standardItemsPayload?.catalogItems||[];if(a+i.length>=t){const r=t-a;return a+=r,{...e,[o]:r}}return a+=i.length,{...e,[o]:i.length}}),{})}function P(e,t){return e.map((e=>{const a=e?.reviewText?.text||"";if(a.length<=t)return e;let r=t;for(;" "!==a[r]&&r>0;)r--;return{...e,reviewText:{...e.reviewText,text:`${a.slice(0,r)}...`}}}))}const T=e=>{let{catalogItem:t,sectionUuid:a,catalogSectionUuid:r,isGrocery:n,isMerchantOffersEnabled:o}=e;return!n&&o?a:t.sectionUuid?t.sectionUuid:r},h=(e,t)=>{let a="";if(!e?.endorsement?.text||"confidence_builders_eater_endorsed"!==e?.endorsementAnalyticsTag)return e?.endorsement?.text;{const r=e.endorsement.text.split(",");"treatment_1"===t&&(a=parseInt(r[0])<60?"":r[0]+"% ("+r[1]+")"),"treatment_2"===t&&(a=parseInt(r[0])<80?"":r[0]+"% ("+r[1]+")")}return a},A=(e,t)=>{let a=0,n=0,o=0;return"treatment_1"!==t&&"treatment_2"!==t||e?.forEach((e=>{e?.payload?.type===r.P.standardItemsPayload&&e?.payload?.standardItemsPayload&&(e?.payload?.standardItemsPayload?.catalogItems||[]).forEach((e=>{n=++n,"confidence_builders_eater_endorsed"===e.endorsementAnalyticsTag&&(a=++a,h(e,t)&&(o=++o))}))})),{totalMenuItems:n,totalMenuItemsWithRatings:a,totalMenuItemsWithRatingsInTreatment:o}},x=e=>!!e.type&&[String(o.xL.BUNDLE_STORE),String(o.xL.HORIZONTAL_GRID),String(o.xL.VERTICAL_GRID),String(o.xL.EATER_MESSAGE),String(o.xL.AD_CANVAS),String(o.xL.ACTIVE_CART),String(o.xL.AISLE_SHORTCUTS)].includes(e.type);function O(e){return"label"===e?.type}function v(e){return Boolean(e?.ctaUri)&&Boolean(e?.ctaMetadata?.ctaLabel)}},96951:(e,t,a)=>{a.d(t,{xL:()=>r});const r=Object.freeze({HORIZONTAL_GRID:"HORIZONTAL_GRID",VERTICAL_GRID:"VERTICAL_GRID",EXPLORE_MENU:"EXPLORE_MENU",EATER_MESSAGE:"EATER_MESSAGE",CATEGORY_LIST_ITEM:"CATEGORY_LIST_ITEM",SPECIAL_REQUEST:"SPECIAL_REQUEST",EMPTY_STATE:"EMPTY_STATE",AD_CANVAS:"AD_CANVAS",BUNDLE_STORE:"BUNDLE_STORE",AISLE_SHORTCUTS:"AISLE_SHORTCUTS",ACTIVE_CART:"ACTIVE_CART",MENU_TRANSLATION:"MENU_TRANSLATION",BASE_ITEMS_GRID:"BASE_ITEMS_GRID"});Object.freeze({SPECIAL_REQUEST:"SPECIAL_REQUEST",REFRESH:"REFRESH",DISMISS:"DISMISS"}),Object.freeze({UNKNOWN:"UNKNOWN",STORE:"STORE",SEE_ALL:"SEE_ALL"})}}]);
//# sourceMappingURL=https://sourcemaps.uberinternal.com/raw/web-eats-v2/client-49386-e9644972841f94ff.js.map