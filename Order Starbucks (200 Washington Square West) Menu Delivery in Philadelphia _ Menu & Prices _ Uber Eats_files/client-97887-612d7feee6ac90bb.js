"use strict";(self.webpackChunkFusion=self.webpackChunkFusion||[]).push([[97887],{6198:(e,r,t)=>{t.d(r,{Ay:()=>l,BP:()=>c});var o=t(90417),a=t(41908),i=t(17649),n=t(61925),d=t(40509),u=t(30505),s=t(35508);function l(e){let r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const{serverCart:t}=(0,a.B_)(),{hasGroupOrder:o}=(0,i.A)();if(o&&r){const r=(t.data?.groupedItems||[]).find((e=>e.isCurrentUser));return(r?.items||[]).filter((r=>"string"!=typeof e||r.uuid===e)).reduce(((e,r)=>e+r.quantity),0)}return(t.data?.items||[]||[]).filter((r=>"string"!=typeof e||r.uuid===e)).reduce(((e,r)=>e+r.quantity),0)}function c(e){const{hasCartToLoad:r,hasCartChanged:t}=(0,n.A)(e),{serverCart:i}=(0,a.B_)(),l=(0,d.A)(),c=(0,u.A)(e),m=(0,o.useMemo)((()=>l?c.cart:i),[l,c.cart,i]),p=(0,o.useMemo)((()=>(m.data?.groupedItems??[]).find((e=>e.isCurrentUser))),[m.data?.groupedItems]),S=(0,o.useMemo)((()=>p?.items&&c.isGroupOrder?p.items:m.data?.items??[]),[p?.items,c.isGroupOrder,m.data?.items]);return{cartCountSummary:(0,o.useMemo)((()=>S.reduce(((e,r)=>(e[r.uuid]?e[r.uuid]+=r.quantity:e[r.uuid]=r.quantity,e)),{})),[S]),cartCountDecimalsSummary:(0,o.useMemo)((()=>S.reduce(((e,r)=>{const t=r.itemQuantity?.inSellableUnit?.value,o=t&&"number"==typeof t.coefficient&&{base:t.coefficient,exponent:t.exponent}||null;return e[r.uuid]&&o?e[r.uuid]=s.R9.from(e[r.uuid]).add(o).toBaseDecimal():e[r.uuid]=o,e}),{})),[S]),cart:m,hasCartToLoad:r,hasCartChanged:t}}},24518:(e,r,t)=>{t.d(r,{OH:()=>i,X8:()=>u,YX:()=>n,al:()=>a,qH:()=>d});var o=t(44743);const a={CUSTOMIZATIONS_METADATA:"/_s/customization-metadata"},i=(0,o.A)({FEED:"feed",STORE:"store",QUICK_VIEW:"quick_view",STORE_DELIVERY_LOCATION:"store_delivery_location",PDP_CROSS_SELL:"pdp_cross_sell",BUNDLE_CAROUSEL:"bundle_carousel",BUNDLE_INTERSTITIAL:"bundle_interstitial",MAGIC_UPSELL:"upsell",GLOBAL_SEARCH:"global_search",COMBO_PAGE:"combo_page"}),n={STORE:"STORE",SECTION_NOT_ON_SALE:"SECTION_NOT_ON_SALE",ITEM_OOS:"ITEM_OOS",NO_DELIVERY_ADDRESS:"NO_DELIVERY_ADDRESS"},d=(0,o.A)({product_details:"product_details",quick_view:"quick_view",canonical_product:"canonical_product"}),u=(0,o.A)({item:"item",upsell:"upsell",boost:"boost"})},56874:(e,r,t)=>{t.d(r,{A:()=>i});var o=t(40304),a=t(18288);const i=()=>(0,o.vm)({...a.E.xlb_friction_batch_3_search,defaultValue:!1})},59350:(e,r,t)=>{t.d(r,{M5:()=>p,PX:()=>d,Z6:()=>S,ZW:()=>l,di:()=>U,eu:()=>m,fS:()=>c,zt:()=>s});var o=t(8301),a=t(97684),i=t(8474);const n=e=>{const r=o.parse(e);return delete r[i.Q71.popoverName],(0,a.X)(r).length?`?${o.stringify(r)}`:""},d=e=>({...e,search:n(e.search||"")}),u=(e,r,t)=>({state:e.state||{},...(0,i.Nel)({location:e,path:e.pathname||"",persistentQueryParams:i.iaX,newQueryParams:{popoverName:r,preserveScroll:1,...t||null}})}),s=(e,r)=>u(e,"pcbLimitReached",{storeUuid:r}),l=e=>u(e,"bundleItemAddedFirst"),c=(e,r,t)=>u(e,"bundleItemsWithStore",{storeUuid:r,source:t}),m=(e,r)=>{const t=(0,i.tJO)(e,r),o=encodeURIComponent(JSON.stringify({diningMode:r}));return(0,i.Zyy)(e,"removeBundledItems",o,t)},p=(e,r)=>u(e,"storefrontError",{storeUuid:r}),S=e=>{let{location:r,secondaryStore:t,primaryBundledStoreUuid:o,primaryDraftOrderUUID:a}=e;const n=(0,i.oLA)(t);return(0,i.NQI)(r,{...n,...n.storeUuid!==o&&{newQueryParams:{primaryBundledStoreUuid:o,primaryDraftOrderUUID:a}}})},U=(e,r)=>{const t=encodeURIComponent(JSON.stringify({storeUuid:r}));return(0,i.Zyy)(e,"merchantUnavailable",t)}},60707:(e,r,t)=>{t.d(r,{A:()=>a});var o=t(66433);function a(){const{isMobile:e}=(0,o.k)(),r=!e;return{isEnabled:r,treatment:r?"cart_animation":"control"}}},74141:(e,r,t)=>{t.d(r,{A:()=>d});var o=t(71085),a=t(35152),i=t(57891),n=t(8474);const d=()=>{const{primaryBundledStoreUuid:e,primaryDraftOrderUUID:r}=(0,a._l)((e=>{const{modalContext:r,primaryBundledStoreUuid:t,primaryDraftOrderUUID:o}=(0,n.g$k)(e,["modalContext","primaryBundledStoreUuid","primaryDraftOrderUUID"]),a=(0,n.uuR)(r);return{primaryBundledStoreUuid:t||a?.primaryBundledStoreUuid,primaryDraftOrderUUID:o||a?.primaryDraftOrderUUID}})),t=(0,i.XU)((e=>e.encodedStoreUuid)),d=(0,o.A)({encodedStoreUuid:t}),u=Boolean(e&&d!==e);return{isSecondaryBundledStore:u,secondaryBundledStoreUuid:u?d:null,primaryBundledStoreUuid:e,primaryDraftOrderUUID:r}}},97887:(e,r,t)=>{t.d(r,{g:()=>y});var o=t(89864),a=t(86105),i=t(8474),n=t(90417),d=t(64825),u=t(24518);const s=()=>{const e=(0,a.W6)(),r=(0,d.A)();return{shopSameStore:n.useCallback((r=>{const t=r.hasLoaded&&r.data?(0,i.NQI)(e.location,(0,i.oLA)(r.data)):null;t&&e.push(t)}),[e]),shopAllStores:n.useCallback((()=>{r((0,i.lGi)(e.location))}),[r,e])}};var l=t(6198),c=t(41908),m=t(74141),p=t(60707),S=t(59350),U=t(66433),_=t(56874),O=t(35152),f=t(57891);const y=()=>{const{openSidebarCart:e}=(0,o.lK)(),r=(0,a.W6)(),t=(0,d.A)(),{isNotOrderValidationErrorModalOpen:y,isPdpCrossSellPreviousLocation:E,isFeedPreviousLocation:v,isGlobalSearchPreviousLocation:I,isBundledOrdersPreviousLocation:h}=(0,O._l)((e=>{const r=e?.state?.previousContext;return{isNotOrderValidationErrorModalOpen:"orderValidationError"!==(0,i.g$k)(e,["modalName"]).modalName,isPdpCrossSellPreviousLocation:r===u.OH.PDP_CROSS_SELL,isFeedPreviousLocation:r===u.OH.FEED,isGlobalSearchPreviousLocation:r===u.OH.GLOBAL_SEARCH,isBundledOrdersPreviousLocation:r===u.OH.BUNDLE_CAROUSEL||r===u.OH.BUNDLE_INTERSTITIAL}})),A=(0,f.XU)((e=>(0,i.G9G)(e))),C=(0,f.XU)((e=>(0,i.tfm)(e))),{validationError:L}=(0,c.tC)(),{shopSameStore:D}=s(),{primaryBundledStoreUuid:B,primaryDraftOrderUUID:N}=(0,m.A)(),g=Boolean(L?.alert?.richBody),{cart:b}=(0,l.BP)(),{isEnabled:P,treatment:T}=(0,p.A)(),R=b?.data?.items.length,{isMobile:M}=(0,U.k)(),k=(0,_.A)();return(0,n.useCallback)((function(){let o=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=arguments.length>1?arguments[1]:void 0,n=arguments.length>3?arguments[3]:void 0,d=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],u=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=arguments.length>6?arguments[6]:void 0;if(arguments.length>7?arguments[7]:void 0)return E?r.goBack():void 0;a||u||(!P||"no_cart_animation"===T)&&P||e();const l=L&&y&&g&&1===R,c=n.data?(0,i.oLA)(n.data):A,m=(0,i.NQI)(r.location,c),p=(0,i.NQI)(r.location,{...c,newQueryParams:{modalName:"orderValidationError"}});if(a){if(A.storeUuid&&A.storeSlug){const e=(0,S.M5)(r.location,c.storeUuid);return r.replace(e)}const e=(0,S.M5)((0,i.NQI)(r.location,c),c.storeUuid);return r.replace(e)}if(o)return r.replace(m);if(l){if(!d){const e=(0,i.Zyy)(r.location,"orderValidationError");return r.push(e)}return r.replace(p)}if(d){if(v||I&&k)return r.replace(m);if(B){if(n.data&&N&&(A.storeUuid!==n.data?.uuid||C?.itemUuid)){if(M&&"pcb_save_for_later"===s&&h)return r.go(-2);const e=(0,S.Z6)({location:r.location,secondaryStore:n.data,primaryBundledStoreUuid:B,primaryDraftOrderUUID:N});return r.push(e)}{if("pcb_save_for_later"===s&&h)return r.go(-2);const e=(0,i.Hwd)((0,S.PX)(r.location));return r.replace(e)}}return t(m)}return u&&D(n),a||u||!P||"control"===T?void 0:r.push(m)}),[P,T,L,y,g,R,A,e,r,B,t,N,M,D,k,C?.itemUuid,E,v,I,h])}}}]);
//# sourceMappingURL=https://sourcemaps.uberinternal.com/raw/web-eats-v2/client-97887-612d7feee6ac90bb.js.map