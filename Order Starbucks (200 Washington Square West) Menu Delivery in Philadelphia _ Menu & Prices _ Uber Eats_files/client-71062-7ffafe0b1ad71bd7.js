"use strict";(self.webpackChunkFusion=self.webpackChunkFusion||[]).push([[71062],{24733:(e,r,t)=>{t.d(r,{A:()=>y});var i=t(90417),n=t(74225),o=t(24727),a=t(12741);var s=t(91156),l=t(84183),u=t(54585),d=t(65416),c=t(41519),p=t(12156);const f=e=>{let{selectedBusinessProfile:r,preferredPaymentProfileUuid:t}=e;const{type:i="",defaultPaymentProfileUuid:n}=r||{};return i===p.d_.Personal?t:n},y=()=>{const e="xlb_synced_profile_event",r=(0,c.A)(),t=(0,s.eh)(),{profileUUID:p,profileType:y}=(0,d.d4)((e=>{let{xlb:r}=e;return r})),{user:U}=(0,l.A)(),{paymentProfileUuid:m}=(0,u.A)(),D=U.data?.isLoggedIn,{data:{selectedProfile:P,defaultBusinessProfileUUID:I,profiles:O}={}}=function(e,r){const t=(0,a.A)("getProfilesForUserV1"),i=(0,o.n)("getProfilesForUserV1",e);return(0,n.useQuery)({queryKey:i,queryFn:e=>{let{queryKey:r}=e;return t.request("getProfilesForUserV1",r[1])},...r?.queryObserverOptions})}({},{queryObserverOptions:{enabled:D}}),{selectedBusinessProfile:_,profileSource:b}=(0,i.useMemo)((()=>{if(O){if(r&&p){const r=O?.find((e=>e?.uuid===p));if(r)return t("eats:xlb_synced_profile_found",{profileType:r?.type,profileUUID:r?.uuid},e),{selectedBusinessProfile:r,profileSource:"XLB_PROFILE_SYNC"};t("eats:xlb_synced_profile_not_found",{profileUUID:p,profileType:y},e)}if(P){const e=O?.find((e=>e?.uuid===P?.profileUUID));if(e)return t("eats:last_selected_profile_found",{profileType:e?.type,profileUUID:e?.uuid}),{selectedBusinessProfile:e,profileSource:"LAST_SELECTED_PROFILE"};t("eats:last_selected_profile_not_found",{profileUUID:P?.profileUUID})}}return{}}),[O,r,p,P,t,y]);return{selectedBusinessProfile:_,profileSource:b,defaultBusinessProfileUUID:I,paymentProfileUuidForSelectedProfile:_?f({selectedBusinessProfile:_,preferredPaymentProfileUuid:m}):null}}},71062:(e,r,t)=>{t.d(r,{A:()=>M});var i=t(90417),n=t(74225),o=t(65416),a=t(76044),s=t(27335),l=t(20697),u=t(68994),d=t(84532),c=t(54585),p=t(19545),f=t(71715),y=t(67905),U=t(61650),m=t(35508),D=t(69616);const P=(e,r)=>e.map((e=>(e.itemQuantity?.inSellableUnit?.measurementUnit?.measurementType!==D.Jf.MEASUREMENT_TYPE_COUNT||!e.itemQuantity.inSellableUnit||e.itemQuantity?.inSellableUnit?.value&&m.R9.from(e.itemQuantity.inSellableUnit.value).toFloat()===e.quantity||(r&&r(e.itemQuantity),e.itemQuantity.inSellableUnit.value=m.R9.from(e.quantity).toCoefficientDecimal()),e)));var I=t(91156),O=t(65372),_=t(56554),b=t(93741),h=t(78972),g=t(98572),v=t(1160);var C=t(93361),S=t(84183),T=t(69536),A=t(24733),k=t(41010),B=t(41568),x=t(31725);const L=e=>{const r="createDraftOrderV2",t=(0,s.A)(r,!0),l=(0,O.gf)(r),d=(0,I.Ay)(),{user:c}=(0,S.A)(),p=c.data?.isLoggedIn,f=(0,o.d4)((e=>{let{delegatedBooking:r}=e;return r})),U=(0,T._)(),m=function(){const e=(0,g.I)(),r=(0,I.Ay)(),{updateDraftOrderV2:t}=(0,h.A)(),{updateUseCredits:i}=(0,u.b8)(),{isDelegatedBooking:n}=(0,_.G)(),o=(0,v.A)("getCheckoutPresentationV1",{continueOnUnmount:!0});return async a=>{if(e&&!n)try{const e=await o({payloadTypes:["paymentProfilesEligibility"],draftOrderUUID:a.uuid}),n=(e?.checkoutPayloads?.paymentProfilesEligibility?.eligibilityPayloadList??[]).map((e=>e.isEligible?{paymentProfileUUID:e?.paymentProfileUUID}:void 0)).filter(Boolean);n.length>0&&(i(!1),await t({draftOrderUUID:a.uuid,extraPaymentProfiles:n,useCredits:!1}),r("eats:healthcare_eligible_order_created",{draftOrderUuid:a.uuid}))}catch(e){}}}(),D=(0,i.useCallback)(O._o,[]),{handleXlbProfileCorrectionDisabling:P}=(0,k.X)(),b=(0,i.useCallback)((r=>{const i=t(r);return e?.(),i}),[t,e]),C=(0,n.useQueryClient)(),A=(0,i.useCallback)(((e,r)=>{d(l,D(r,p,f)),e?.cartsView&&C.setQueryData(y.e,e.cartsView),U.enqueue(e?.draftOrderPresentationResponse),e?.draftOrder&&(m(e.draftOrder),P(e.draftOrder))}),[d,l,D,p,f,U,C,m,P]),B=(0,i.useCallback)(((e,r)=>{d(l,{...D(r),error:e})}),[D,d,l]),x=(0,n.useMutation)(b,{onSuccess:A,onError:B});return{createDraftOrderMaybe:(0,a.jf)(x),createDraftOrderV2:x.mutateAsync}};function M(e,r,t){const{notifyExternalSyncToCart:n}=(0,B._)(),{createDraftOrderV2:a,createDraftOrderMaybe:s}=L(r),{paymentProfileUuid:y}=(0,c.A)(),{selectedPromotionUuid:m,skipApplyingPromotion:D}=(0,o.d4)((e=>{let{checkout:r}=e;return r}))||{},{deliveryInstructions:O}=(0,l.Ku)(),h=O.data?.selectedInstruction?.interactionType||O.data?.preferredInteractionType||C.te.interactionType,g=(0,d.A)(),v=(0,x.A)("create_draft_order_notify_external_sync_to_cart"),{paymentIntent:S}=(0,u.b8)(),T="business"===S,{isInMulticart:k}=(0,f.A)(),M=(0,I.Ay)(),V=(0,_.G)(),{selectedBusinessProfile:E,profileSource:q,paymentProfileUuidForSelectedProfile:Q}=(0,A.A)();return{createDraftOrderMaybe:s,createDraftOrder:(0,i.useCallback)((async r=>{let{shoppingCartItems:i,isBandwagon:o,groupOrderStoreUUID:s,spendingLimit:l,currencyCode:u,businessDetails:d,billSplitOption:c,addParticipantsIntended:f,displayName:I,cartLockOptions:O,deliveryTime:_,actionMeta:C,promotionUuid:S,handledHighCapacityOrderMetadata:A,repeatOrderOptions:B,primaryDraftOrderUUID:x,draftOrderPresentationContext:L,deliveryType:F,addOnOfferContext:N,storeLocation:w}=r;const R=S||m;let z={isMulticart:k,shoppingCartItems:i,useCredits:!0,extraPaymentProfiles:[],promotionOptions:{autoApplyPromotionUUIDs:[],selectedPromotionInstanceUUIDs:R?[R]:[],skipApplyingPromotion:D},deliveryTime:_,deliveryType:o?"BANDWAGON":"ASAP",groupOrderStoreUUID:s,spendingLimit:l,currencyCode:u,addParticipantsIntended:f,interactionType:h,paymentProfileUUID:y,billSplitOption:c,displayName:I,checkMultipleDraftOrdersCap:k,cartLockOptions:O,actionMeta:C,draftOrderPresentationContext:L,...x&&{createBundleGroup:{primaryDraftOrderUUID:x}},addOnOfferContext:N,storeLocation:w};F&&(z.deliveryType=F),E?(z.businessDetails={profileType:E?.type,profileUUID:E?.uuid},z.paymentProfileUUID=Q,z.analyticsRelevantData={profileSource:q}):d&&d.profileUUID?z.businessDetails={profileUUID:d.profileUUID,profileType:d.profileType,policyUUID:d.policyUUID,policyVersion:d.policyVersion,expenseCode:d.expenseCode,expenseMemo:d.expenseMemo,expenseTrip:d.expenseTrip,businessTrip:d.businessTrip,organizationUUID:d.organizationUUID,voucherUUID:d.voucherUUID,voucherPolicyVersion:d.voucherPolicyVersion}:z.businessDetails={},!T&&g?.voucherUUID&&c!==p.s.SPLIT_BY_SUBTOTAL&&(z.businessDetails.voucherPolicyVersion=g?.voucherData?.policy?.version,z.businessDetails.voucherUUID=g?.voucherUUID),A&&(z.handledHighCapacityOrderMetadata={hhcOrderSize:A.hhcOrderSize}),B&&(z.repeatSchedule=(0,U.u5)({repeatOrderOptions:B})),null!=i&&(z.shoppingCartItems=P(i,(r=>{M("eats:create_draft_order_quantity_item_quantity_mismatch",{itemQuantity:JSON.stringify(r),source:e,request:JSON.stringify(z)})}))),"reorder"===e&&(z.shoppingCartItems=z.shoppingCartItems?.map((e=>({...e,itemQuantity:{...e.itemQuantity,inPriceableUnit:null}})))),V?.isDelegatedBooking&&(z=(0,b.JZ)(z,V)),t&&(z.creationSurface=t);const G=await a(z),{draftOrder:J}=G??{};return J&&v&&n({storeId:J.storeUuid,cartId:J.uuid}),G}),[k,a,h,T,y,S,m,g.voucherData?.policy?.version,g.voucherUUID,D])}}},98572:(e,r,t)=>{t.d(r,{I:()=>o});var i=t(40304),n=t(1139);function o(){return(0,i.vm)({...n.z.is_healthcare_card_enabled,defaultValue:!1})}}}]);
//# sourceMappingURL=https://sourcemaps.uberinternal.com/raw/web-eats-v2/client-71062-7ffafe0b1ad71bd7.js.map