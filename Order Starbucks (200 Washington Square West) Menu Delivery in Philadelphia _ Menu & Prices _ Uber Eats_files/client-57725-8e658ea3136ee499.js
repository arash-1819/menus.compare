"use strict";(self.webpackChunkFusion=self.webpackChunkFusion||[]).push([[57725,87177],{38659:(e,r,t)=>{t.d(r,{A:()=>n});var a=t(79193),o=t(16439),s=t(91156),d=t(66433),i=t(82840);const n=()=>{const{isIOS:e,isAndroid:r}=(0,d.k)(),t=(0,o.A)(),n=(0,s.Ay)();return o=>{if("undefined"!=typeof a.A&&t){n("eats:emit_bridge_event",{device:e?"ios":r?"android":"unknown",eventType:o.type??"unknown",bridgeType:"presidio_core"});const t=JSON.stringify({messageID:o.messageID||(0,i.A)(),type:o.type,payload:o?.payload});try{if(a.A?.presidio_web_core_bridge?.postMessage)a.A.presidio_web_core_bridge.postMessage(t);else{if(!a.A?.webkit?.messageHandlers?.presidio_web_core_bridge?.postMessage)throw new Error("No valid mobile bridge found");a.A.webkit.messageHandlers.presidio_web_core_bridge.postMessage(t)}}catch(t){n("eats:failed_to_emit_bridge_event",{device:e?"ios":r?"android":"unknown",eventType:o.type??"unknown",bridgeType:"presidio_core",hasIOSBridge:Boolean(a.A?.webkit?.messageHandlers?.presidio_web_core_bridge),hasAndroidBridge:Boolean(a.A?.presidio_web_core_bridge),eventPayload:JSON.stringify(o),errorMessage:t instanceof Error?t.message:String(t)})}}}}},61269:(e,r,t)=>{t.d(r,{iq:()=>u,_f:()=>c,pf:()=>l});var a=t(74225),o=t(24727),s=t(12741),d=t(47577);function i(e,r){return!e.isFetched&&(r?.enabled??!0)}var n=t(84183);const c=["getRepeatOrderViewV1"],u=e=>[...c,{repeatOrderTemplateUUIDs:[e]}],l=(e,r)=>{const{refetchInterval:t,...c}=r??{},{user:u}=(0,n.A)(),l=function(e,r){const t=(0,s.A)("getRepeatOrderViewV1"),n=(0,a.useQueryClient)(),c=(0,o.n)("getRepeatOrderViewV1",e),u=(0,a.useQuery)({queryKey:c,queryFn:e=>{let{queryKey:r}=e;return t.request("getRepeatOrderViewV1",r[1])},...r?.queryObserverOptions});return(0,d.A)((()=>(r.ssrPredicate||i)(u,r.queryObserverOptions)?n.prefetchQuery({queryKey:c,queryFn:e=>{let{queryKey:r}=e;return t.request("getRepeatOrderViewV1",r[1])}}):null),[u,t,c,n,r.queryObserverOptions,r.ssrPredicate],r.preparedId,(0,a.hashQueryKey)(c)),u}(e,{preparedId:"get-repeat-order-view",queryObserverOptions:{refetchOnMount:"always",enabled:Boolean(e.repeatOrderTemplateUUIDs.length)&&u.data?.isLoggedIn,refetchInterval:(e,r)=>"401"!==r.state?.error?.code&&(e?.loadingState?.isLoading?e?.loadingState.reloadInMs.low:t||!1),...c}});return l}},68279:(e,r,t)=>{t.d(r,{A:()=>w});var a=t(90417),o=t(91156),s=t(89831),d=t(73077),i=t(49534),n=t(37959),c=t(11752),u=t(9473),l=t(71715),g=t(40509),p=t(87177),f=t(17649),h=t(74225),U=t(39107),y=t(67905),b=t(12741),O=t(41568),A=t(41908);const I=()=>{const e="discardBundleGroup",r=(0,b.A)(e),t=(0,h.useQueryClient)(),a=(0,s.wA)(),{draftOrders:o}=(0,A.tC)(),{notifyDiscardedOrder:d}=(0,O._)(),i=(0,h.useMutation)((t=>r.request(e,t)),{onMutate:async e=>{let{bundleGroupUUID:r,shouldRemoveDraftOrders:a}=e;a&&(await t.fetchQuery(y.e),t.setQueryData(y.e,(e=>({...e,...e.carts&&{carts:e.carts.filter((e=>e.metadata?.openCheckoutMetadata?.bundleGroupMetadata?.bundleGroupUUID!==r))}}))),t.removeQueries([,r]))},onSuccess:e=>{let{discardedDraftOrderUUIDs:r}=e;t.invalidateQueries(["getFeedDraftOrderItemsUpdateV1"]),r?.forEach((e=>{d({storeId:o?.data?.[e]?.data?.draftOrder?.storeUuid??""}),a((0,U.b8)(e))}))}});return{discardBundleGroup:i.mutateAsync}};var D=t(42989),m=t(56554),_=t(78275),v=t(8700);function w(e){const r=(0,o.Ay)(),t=(0,c.A)(),{draftOrderUUID:h,bundleGroupUUID:U,mealPlanUUID:y,storeUUID:b=""}=(0,A.tC)(),O=(0,s.wA)(),{discardDraftOrder:w}=(0,p.A)(),{discardBundleGroup:C}=I(),{setActiveDraftOrder:$}=(0,l.A)(),R=(0,g.A)(),{isDraftOrderParticipant:k}=(0,f.A)(),{isDelegatedBooking:T,firePostMessage:M}=(0,m.G)(),{isCartDrafting:G}=(0,_.A)(),{store:Q}=(0,v.Ay)(b),V=Q?.data?.location?.locationType;return(0,a.useCallback)((async function(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:b,o=arguments.length>1?arguments[1]:void 0;r("eats:clear_cart",{draftOrderUuid:h||"",source:e,isDrafting:G,locationType:V}),k?r("eats:invalid_clear_cart_participant_attempt",{draftOrderUuid:h||"",source:e}):(T&&M({type:D.gc.CART_REMOVED,payload:{draftOrderUuid:h}}),a&&O((0,n.CJ)(a)),R&&h?(U?C({bundleGroupUUID:U,shouldRemoveDraftOrders:!0}):w({draftOrderUUIDs:[h],repeatOrderTemplateUUID:o,mealPlanUUID:y,storeUUID:a}),$()):(w({draftOrderUUIDs:[h],storeUUID:a}),(0,d.Gd)(t),O((0,u.Ms)()),O((0,i.DQ)())))}),[r,h,e,G,R,O,k,U,$,C,w,y,t,T,M,b,V])}},87177:(e,r,t)=>{t.d(r,{A:()=>I});var a=t(74225),o=t(67905),s=t(61269),d=t(84329),i=t(91156),n=t(27335),c=t(65372),u=t(11135),l=t(32879),g=t(71715),p=t(39107),f=t(65416),h=t(89831),U=t(9473),y=t(37959),b=t(41568),O=t(66371),A=t(85951);function I(){const{notifyDiscardedOrder:e}=(0,b._)(),{setActiveDraftOrder:r,activeDraftOrderUUID:t}=(0,g.A)(),I=(0,f.d4)((e=>e.draftOrders.draftOrders)),D=(0,u.U)(),{dataKey:m}=(0,l.gX)(),_="discardDraftOrdersV1",v=(0,n.A)(_),w=(0,c.gf)(_),C=(0,a.useQueryClient)(),$=(0,h.wA)(),R=(0,i.Ay)(),k=(0,d.C)(),{stopTiming:T}=(0,O.zR)(),M=(0,a.useMutation)({mutationFn:v,onMutate:e=>{let{draftOrderUUIDs:r,bundleGroupUUID:a}=e;C.cancelQueries(o.e);const s=C.getQueryData(o.e);if(s&&C.setQueryData(o.e,{...s,carts:s.carts.filter((e=>!r.includes(e.draftOrderUUID)))}),r.forEach((e=>C.removeQueries([,e]))),a&&C.setQueryData(m,(e=>{const t=e?.checkoutPayloads?.cartItems;return t?.cartItemsGroups&&(t.cartItemsGroups=t.cartItemsGroups.filter((e=>{let{draftOrderUUID:t}=e;return t&&!r.includes(t)}))),e})),r.forEach((e=>$((0,p.b8)(e)))),r.includes(t)){const e=I.data?.[t];$((0,U.Ms)()),$((0,y.CJ)(e?.data?.draftOrder?.storeUuid||""))}},onSuccess:(t,a)=>{let{draftOrders:o}=t,{repeatOrderTemplateUUID:d,bundleGroupUUID:i,mealPlanUUID:n,storeUUID:c}=a;if(T(`${A.s.CLEAR_CART}_${c}`,{shouldEmitTiming:!0,overrideLabelFn:()=>A.s.CLEAR_CART}),e({storeId:c??""}),i){const e=1===o?.length?o?.[0]:o?.find((e=>"PRIMARY"===e.bundleGroupInfo?.bundleGroupRole));e&&r(e.uuid),D({cartViews:!0,checkoutPresentation:!0})}R(w,k),C.invalidateQueries(["getFeedDraftOrderItemsUpdateV1"]),d&&C.invalidateQueries((0,s.iq)(d),{refetchInactive:!0}),n&&(C.invalidateQueries(["getMealPlanOrdersViewV1",{mealPlanUUID:n}]),D({cartViews:!0}))},onError:e=>{R(w,{...k,error:e})}});return{discardDraftOrder:M.mutateAsync}}},89077:(e,r,t)=>{t.d(r,{Ay:()=>g});var a=t(25263),o=t(70028),s=t(12830),d=t(1474),i=t(41967),n=t(67319);var c=t(40014);const u=(0,i.I4)("div",(e=>{let{$height:r,$width:t}=e;return{position:"relative",width:t||0,height:r||0}})),l=(0,i.I4)("div",(e=>{let{$theme:r,$backgroundColor:t,$color:a,$top:o,$bottom:s,$left:d,$right:i}=e;return{position:"absolute",display:"flex",alignItems:"center",justifyContent:"center",top:o,right:i,left:d,bottom:s,width:r.sizing.scale700,borderRadius:r.borders.radiusFull,height:r.sizing.scale700,...t?{backgroundColor:r.colors[t]}:{},...a?{color:r.colors[a]}:{}}})),g=e=>{let{width:r,height:t,children:g,badge:p,position:f}=e;const[,h]=(0,i.c6)();return(0,c.FD)(u,{$width:r,$height:t,children:[g,(()=>{if("icon"!==p?.content?.type)return;const e=p?.content?.icon,{backgroundColor:r,color:t}=(e=>{let r="contentOnColor",t=null;return"standard"===e?.type?t=(0,n.oU)(e?.standard):"custom"===e?.type&&(r=(0,n.oU)(e?.custom?.contentColor),t="JOY_PRIMARY"===e?.custom?.backgroundColor?(0,n.oU)("WARNING"):(0,n.oU)(e?.custom?.backgroundColor)),{color:r,backgroundColor:t}})(p?.color),i=(e=>{const r={$bottom:"auto",$top:"auto",$left:"auto",$right:"auto"};switch(e){case"BOTTOM_LEFT":return{...r,$bottom:"0",$left:"0"};case"BOTTOM_RIGHT":return{...r,$bottom:"0",$right:"0"};case"TOP_LEFT":return{...r,$top:"0",$left:"0"};case"TOP_RIGHT":return{...r,$top:"0",$right:"0"};default:return{...r}}})(f);switch(e){case"CHECKMARK":return(0,c.Y)(l,{$color:t,$backgroundColor:r,...i,"data-test":"badge-icon",children:(0,c.Y)(o.A,{height:h.sizing.scale500,width:h.sizing.scale500,children:(0,c.Y)(d.A,{})})});case"ARROW_CIRCULAR":return(0,c.Y)(l,{$color:t,$backgroundColor:r,...i,"data-test":"badge-icon",children:(0,c.Y)(o.A,{height:h.sizing.scale500,width:h.sizing.scale500,children:(0,c.Y)(s.A,{})})});case"X":return(0,c.Y)(l,{$color:t,$backgroundColor:r,...i,"data-test":"badge-icon",children:(0,c.Y)(o.A,{height:h.sizing.scale500,width:h.sizing.scale500,children:(0,c.Y)(a.A,{size:"24"})})});default:return null}})()]})}}}]);
//# sourceMappingURL=https://sourcemaps.uberinternal.com/raw/web-eats-v2/client-57725-8e658ea3136ee499.js.map